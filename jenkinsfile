pipeline {
  environment {
        registry = "loiss/loissp"
        registryCredential = 'dockerhub'
        dockerImage = ''
        loispwd=credentials("dbpwd")
  }
   agent any
   stages {
    //  stage('Clone Git repo') {
    //     steps {
    //       git branch: 'main',
    //       url: 'https://github.com/loiss-g/loistries_DnD-character-Gen.git'
    //     }
    // }
    stage ('Build') {
       steps {
           sh 'pwd'
           step([$class: 'DockerComposeBuilder', dockerComposeFile: 'docker-compose.yaml', option: [$class: 'StartAllServices'], useCustomDockerComposeFile: true])
       }
    }
    stage ('Test') {
        steps {
          withPythonEnv ('python') {
             sh 'pytest test_frontend_.py'
          }
       }
    }
    stage ('push images to dockerhub') {
       steps{
         script{
            docker.withRegistry('', registryCredential ) {
              dockerImage.push()
            }
         }
       }
    }
   }
}