pipeline {
  environment {
        registry = "loiss/loissp"
        registryCredential = 'dockerhub'
        dockerImage = ''
  }
   agent any
   stages {
     stage('Clone Git repo') {
        steps {
          git branch: 'main',
          url: 'https://github.com/loiss-g/loistries_DnD-character-Gen'
        }
    }
    stage ('Build') {
       steps{
           sh './docker-compose up --build'
       }
    }
    stage ('Test') {
        steps {
          withPythonEnv ('python') {
             sh 'pytest test_frontend_.py'
          }
       }
    }
    stage ('push images to dockerhub') {
       steps{
         script{
            docker.withRegistry('', registryCredential ) {
              dockerImage.push()
            }
         }
       }
    }
   }   
}